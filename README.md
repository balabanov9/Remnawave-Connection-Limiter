# Remnawave Connection Limiter

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ VPN –Ω–∞ –±–∞–∑–µ –ø–∞–Ω–µ–ª–∏ [Remnawave](https://github.com/remnawave/backend).

–ï—Å–ª–∏ —é–∑–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (IP), —á–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–æ (`hwidDeviceLimit`) ‚Äî –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥—Ä–æ–ø–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ iptables.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   VPN Node  ‚îÇ     ‚îÇ   VPN Node  ‚îÇ     ‚îÇ   VPN Node  ‚îÇ
‚îÇ  (Finland)  ‚îÇ     ‚îÇ  (Poland)   ‚îÇ     ‚îÇ  (Germany)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚îÇ    POST /log      ‚îÇ                   ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ  Central Server ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ Web Admin :8080
                 ‚îÇ  (this script)  ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ             ‚îÇ             ‚îÇ
            ‚ñº             ‚ñº             ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  Node 1  ‚îÇ  ‚îÇ  Node 2  ‚îÇ  ‚îÇ  Node 3  ‚îÇ
      ‚îÇ iptables ‚îÇ  ‚îÇ iptables ‚îÇ  ‚îÇ iptables ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

1. –ù–∞ –∫–∞–∂–¥–æ–π VPN –Ω–æ–¥–µ –∑–∞–ø—É—â–µ–Ω `node_reporter.py` ‚Äî –ø–∞—Ä—Å–∏—Ç –ª–æ–≥–∏ Xray –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
2. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å—á–∏—Ç–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞
3. –ï—Å–ª–∏ IP > –ª–∏–º–∏—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –Ω–∞ –Ω–æ–¥—ã –¥—Ä–æ–ø–Ω—É—Ç—å –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ iptables
4. –Æ–∑–µ—Ä –ù–ï –±–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏, –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- –ü–∞–Ω–µ–ª—å Remnawave 2.0+
- Xray —Å `loglevel: warning`

## –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

```bash
git clone https://github.com/balabanov9/Remnawave-Connection-Limiter.git
cd Remnawave-Connection-Limiter
pip install -r requirements.txt
nano config.py  # –Ω–∞—Å—Ç—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
bash install_server.sh
```

### VPN –Ω–æ–¥–∞

```bash
git clone https://github.com/balabanov9/Remnawave-Connection-Limiter.git
cd Remnawave-Connection-Limiter
bash install_node.sh
nano /opt/node-reporter/node_reporter.py  # –Ω–∞—Å—Ç—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
systemctl start node-reporter
```

## –í–µ–±-–ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `http://YOUR_SERVER:8080`

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è config.py
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ —é–∑–µ—Ä—ã)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
- –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ê–¥–º–∏–Ω–∫–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
```bash
# –ó–∞–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç –∏–∑–≤–Ω–µ
ufw deny 8080

# –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å
ssh -L 8080:localhost:8080 root@your-server
# –ü–æ—Ç–æ–º –æ—Ç–∫—Ä—ã—Ç—å http://localhost:8080
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# Remnawave API
REMNAWAVE_API_URL = "http://localhost:3000"  # –±–µ–∑ /api
REMNAWAVE_API_TOKEN = "your_token"

# –ü—Ä–æ–≤–µ—Ä–∫–∞
CHECK_INTERVAL_SECONDS = 120  # –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
IP_WINDOW_SECONDS = 120       # –æ–∫–Ω–æ –ø–æ–¥—Å—á—ë—Ç–∞ IP
DROP_DURATION_SECONDS = 60    # –Ω–∞ —Å–∫–æ–ª—å–∫–æ –¥—Ä–æ–ø–∞—Ç—å

# Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN = ""
TELEGRAM_CHAT_ID = ""

# –ù–æ–¥—ã
NODE_API_PORT = 5001
NODE_API_SECRET = "your_secret"
NODES = {
    "finland-1": "1.2.3.4",
    "poland-1": "5.6.7.8",
}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Xray

–í –∫–æ–Ω—Ñ–∏–≥–µ Xray –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `loglevel: warning`:

```json
{
  "log": {
    "access": "/var/log/xray/access.log",
    "loglevel": "warning"
  }
}
```

## –ü–æ—Ä—Ç—ã

| –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| 5000 | –ü—Ä–∏—ë–º –ª–æ–≥–æ–≤ –æ—Ç –Ω–æ–¥ |
| 5001 | API –Ω–∞ –Ω–æ–¥–∞—Ö –¥–ª—è –∫–æ–º–∞–Ω–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| 8080 | –í–µ–±-–ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
systemctl status connection-limiter
systemctl restart connection-limiter
journalctl -u connection-limiter -f

# VPN –Ω–æ–¥–∞
systemctl status node-reporter
systemctl restart node-reporter
journalctl -u node-reporter -f
```

## Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –¥—Ä–æ–ø–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
```
üîª Drop: User 810
IPs: 4, Limit: 2
Dropped: {'92.36.5.79', '176.59.77.72'}
```

## –û—á–∏—Å—Ç–∫–∞ iptables –Ω–∞ –Ω–æ–¥–∞—Ö

```bash
# –ù–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö —Å—Ä–∞–∑—É
for node in 1.2.3.4 5.6.7.8; do
  ssh root@$node "iptables -F INPUT"
done
```

## License

MIT
