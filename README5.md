# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ v5: –ü—Ä–æ—Å—Ç–æ–π –¥—Ä–æ–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–±–µ–∑ –±–∞–Ω–∞)

## –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
1. –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —é–∑–µ—Ä–æ–≤
2. –ï—Å–ª–∏ IP > HWID –ª–∏–º–∏—Ç ‚Üí –¥—Ä–æ–ø–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ iptables
3. –Æ–∑–µ—Ä –ù–ï –±–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏, –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
–Æ–∑–µ—Ä —Å –ª–∏–º–∏—Ç–æ–º 2 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è —Å 4 IP:
- IP1: 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω)
- IP2: 8 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–ª–∞–Ω—à–µ—Ç)  
- IP3: 2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–Ω–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω)
- IP4: 1 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–µ—â—ë —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)

–†–µ–∑—É–ª—å—Ç–∞—Ç: IP3 –∏ IP4 –±—É–¥—É—Ç –¥—Ä–æ–ø–Ω—É—Ç—ã (—É –Ω–∏—Ö –º–µ–Ω—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π = –Ω–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
```

## API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç–Ω–¥–ø–æ–∏–Ω—Ç: `GET /api/hwid/devices/{userUuid}`

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
CHECK_INTERVAL_SECONDS = 120

# –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ IP
IP_WINDOW_SECONDS = 120

# –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥—Ä–æ–ø–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
DROP_DURATION_SECONDS = 60

# –ù–æ–¥—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –¥—Ä–æ–ø–∞
NODES = {
    "finland-1": "1.2.3.4",
    "poland-1": "5.6.7.8",
}
```

## Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –¥—Ä–æ–ø–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üîª Drop: User 810
IPs: 4, Limit: 2
Dropped: {'92.36.5.79', '176.59.77.72'}
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
cd /root/Remnawave-Connection-Limiter
git pull

# –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é –±–∞–∑—É
rm connections.db

# –û–±–Ω–æ–≤–∏ config.py - —Ç–∞–º –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏
sudo systemctl restart connection-limiter
```

## –ß—Ç–æ —É–±—Ä–∞–Ω–æ

- –ë–∞–Ω —é–∑–µ—Ä–∞ –≤ –ø–∞–Ω–µ–ª–∏ (disable/enable)
- VIOLATION_CONFIRM_COUNT (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π)
- –¢–∞–±–ª–∏—Ü–∞ blocked_users –≤ –ë–î
- KICK_IPS_ON_VIOLATION —Ñ–ª–∞–≥ (—Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –¥—Ä–æ–ø–∞–µ–º)

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `checker.py` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
- `config.py` - —É–ø—Ä–æ—â—ë–Ω, –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `remnawave_api.py` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ get_user_hwid_limit()
- `telegram_bot.py` - –¥–æ–±–∞–≤–ª–µ–Ω notify_drop()
- `database.py` - —É–±—Ä–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ blocked_users
